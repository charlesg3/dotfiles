#!/bin/bash

# If not running interactively, don't do anything
[ -z "$PS1" ] && return

[[ -f /usr/share/blesh/ble.sh ]] && source /usr/share/blesh/ble.sh --noattach

export PATH="$HOME/.local/bin:$HOME/src/dotfiles/scripts:$PATH"

alias tmux='tmux -2'

export TERM=xterm-256color
export HISTCONTROL=ignoredups

unset JAVA_TOOL_OPTIONS

ulimit -c unlimited

shopt -s checkwinsize

# enable color support of ls
if [ "$TERM" != "dumb" ]; then
    eval "$(dircolors -b)"
    alias ls='ls --color=auto'
fi

# BASH_SOURCE resolves to this file; walk up bash/ -> dotfiles/
_dotfiles="$(dirname "$(realpath "${BASH_SOURCE[0]}")")/.."
source "$_dotfiles/shell/aliases.sh"
unset _dotfiles

# make less more friendly for non-text input files
[ -x /usr/bin/lesspipe ] && eval "$(lesspipe)"

# set terminal title to user@host:dir
case "$TERM" in
xterm*|rxvt*|vt102|screen*)
    PROMPT_COMMAND='echo -ne "\033]0;${USER}@${HOSTNAME}: ${PWD}\007"'
    export PROMPT_COMMAND
    ;;
esac

# set variable identifying the chroot you work in
if [ -z "$debian_chroot" ] && [ -r /etc/debian_chroot ]; then
    debian_chroot=$(cat /etc/debian_chroot)
fi

# colorful prompt
case "$TERM" in
xterm*|rxvt*|screen*|vt102)
    PS1='${debian_chroot:+($debian_chroot)}$(if [ $? -eq 0 ]; then echo "\[\033[00;32m\]▸\[\033[00m\]"; else echo "\[\033[00;31m\]▸\[\033[00m\]"; fi)\[\033[00;32m\]\u\[\033[00;31m\]@\[\033[00;32m\]\h\[\033[00m\]:\[\033[00;36m\]\w\[\033[00;33m\]\$\[\033[00m\] '
    ;;
*)
    PS1='${debian_chroot:+($debian_chroot)}\u@\h:\w→ '
    ;;
esac

PS2='$'

# bash completion
if [ -f /etc/bash_completion ]; then
    . /etc/bash_completion
elif [ "$(uname)" = "Darwin" ] && [ -r "$(brew --prefix 2>/dev/null)/etc/profile.d/bash_completion.sh" ]; then
    . "$(brew --prefix)/etc/profile.d/bash_completion.sh"
fi

# ── Local overrides (machine-specific, not tracked) ──────────────────────────
[ -f "$HOME/.bashrc.local" ] && . "$HOME/.bashrc.local"

[[ ${BLE_VERSION-} ]] && ble-attach
